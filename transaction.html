<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Transaction History</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f2f2f2;
}
.header{
  background:#0b0f0e;
  color:#1abc9c;
  padding:14px;
  text-align:center;
  font-size:20px;
}
.card{
  background:#fff;
  margin:12px;
  padding:12px;
  border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.row{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
}
.type{
  font-weight:bold;
}
.pending{color:#f9a825}
.approved{color:#1abc9c}
.rejected{color:#ff6b6b}
.completed{color:#2196f3}
.small{font-size:13px;color:#666}
</style>
</head>

<body>

<div class="header">ðŸ”„ Transaction History</div>
<div id="list"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth,onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { 
 getFirestore,collection,query,where,getDocs,orderBy 
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const app = initializeApp({
 apiKey:"AIzaSyBFsTzlRPoWHVXEHbKrPdwxslxZGa7Kqfw",
 projectId:"biniyog-95d00"
});

const auth = getAuth(app);
const db = getFirestore(app);
const list = document.getElementById("list");

onAuthStateChanged(auth, async(user)=>{
 if(!user){
  location.href="index.html";
  return;
 }
 loadAll(user.uid);
});

async function loadAll(uid){
 list.innerHTML="";

 // ðŸ”µ Deposits
 const depQ=query(
  collection(db,"deposit_requests"),
  where("uid","==",uid),
  orderBy("time","desc")
 );
 const depSnap=await getDocs(depQ);
 depSnap.forEach(d=>{
  const x=d.data();
  addCard("Deposit",x.amount,x.status,
    "TXID: "+x.txid);
 });

 // ðŸ”´ Withdraws
 const wQ=query(
  collection(db,"withdraw_requests"),
  where("uid","==",uid),
  orderBy("time","desc")
 );
 const wSnap=await getDocs(wQ);
 wSnap.forEach(d=>{
  const x=d.data();
  addCard("Withdraw",x.amount,x.status,
    x.method);
 });

 // ðŸŸ¢ Plans
 const pQ=query(
  collection(db,"user_plans"),
  where("uid","==",uid),
  orderBy("start","desc")
 );
 const pSnap=await getDocs(pQ);
 pSnap.forEach(d=>{
  const x=d.data();
  addCard("Plan Income",x.totalEarn,
    x.status,"Plan: "+x.planName);
 });

 if(list.innerHTML===""){
  list.innerHTML="<p style='text-align:center;color:#777'>No transactions</p>";
 }
}

function addCard(type,amount,status,extra){
 const div=document.createElement("div");
 div.className="card";
 div.innerHTML=`
  <div class="row">
    <div class="type">${type}</div>
    <div>à§³ ${amount}</div>
  </div>
  <div class="row">
    <div class="${status}">${status.toUpperCase()}</div>
    <div class="small">${extra||""}</div>
  </div>
 `;
 list.appendChild(div);
}
</script>

</body>
</html>
