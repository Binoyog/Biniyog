<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Withdraw</title>

<style>
body{margin:0;font-family:Arial;background:#f2f2f2}
.header{padding:15px;background:#020617;color:#1abc9c;font-size:20px}
.container{padding:15px}
.card{
  background:#fff;
  padding:14px;
  border-radius:8px;
  margin-bottom:12px;
}
button{
  padding:6px 12px;
  border:none;
  border-radius:4px;
  cursor:pointer;
}
.approve{background:#22c55e}
.reject{background:#f87171}
</style>
</head>
<body>

<div class="header">ðŸ‘‘ Withdraw Approval</div>
<div class="container" id="list">Loading...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { 
  getFirestore, collection, query, where, getDocs,
  updateDoc, doc, getDoc 
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyBFsTzlRPoWHVXEHbKrPdwxslxZGa7Kqfw",
  projectId:"biniyog-95d00"
});
const auth=getAuth(app);
const db=getFirestore(app);
const list=document.getElementById("list");

onAuthStateChanged(auth,user=>{
  if(!user||user.email!=="admin@biniyog.com"){
    location.href="index.html";return;
  }
  load();
});

async function load(){
  list.innerHTML="";
  const q=query(collection(db,"withdraw_requests"),where("status","==","pending"));
  const snap=await getDocs(q);
  snap.forEach(d=>{
    const r=d.data();
    list.innerHTML+=`
      <div class="card">
        <b>à§³ ${r.amount}</b><br>
        ${r.phone} (${r.method})<br><br>
        <button class="approve" onclick="approve('${d.id}','${r.uid}',${r.amount})">Approve</button>
        <button class="reject" onclick="reject('${d.id}')">Reject</button>
      </div>`;
  });
}

window.approve=async(id,uid,amt)=>{
  const uref=doc(db,"users",uid);
  const snap=await getDoc(uref);
  const bal=snap.data().balance||0;
  await updateDoc(uref,{balance:bal-amt});
  await updateDoc(doc(db,"withdraw_requests",id),{status:"approved"});
  load();
};

window.reject=async(id)=>{
  await updateDoc(doc(db,"withdraw_requests",id),{status:"rejected"});
  load();
};
</script>
</body>
</html>
