<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Biniyog | Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f2f2f2;
}
.header{
  background:#d81b60;
  color:#fff;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.balance-box{
  background:#fff;
  color:#d81b60;
  padding:6px 12px;
  border-radius:20px;
  font-weight:bold;
}
.notice{
  background:#f9a825;
  color:#fff;
  margin:10px;
  padding:10px;
  border-radius:8px;
  font-size:14px;
}
.grid{
  background:#fff;
  margin:10px;
  padding:15px;
  border-radius:12px;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:15px;
  text-align:center;
}
.item{
  color:#d81b60;
  font-size:13px;
}
.item div{
  background:#d81b60;
  color:#fff;
  border-radius:50%;
  width:55px;
  height:55px;
  display:flex;
  justify-content:center;
  align-items:center;
  margin:auto;
  font-size:20px;
}
.section{
  background:#fff;
  margin:10px;
  padding:15px;
  border-radius:12px;
}
button{
  width:100%;
  padding:10px;
  border:none;
  border-radius:8px;
  background:#7a2fbf;
  color:#fff;
  margin-top:10px;
  font-size:14px;
}
.tx{
  font-size:13px;
  border-bottom:1px solid #eee;
  padding:6px 0;
}
</style>
</head>

<body>

<div class="header">
  <div>üë§ Profile</div>
  <div class="balance-box">‡ß≥ <span id="balance">0</span></div>
  <div onclick="logout()" style="cursor:pointer">Logout</div>
</div>

<div class="notice">
  ‡¶¨‡¶ø‡¶®‡¶ø‡¶Ø‡¶º‡ßã‡¶ó ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ï‡ßá‡¶ü‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ
</div>

<div class="grid">
  <div class="item"><div>‚úì</div>Task</div>
  <div class="item"><div>‡ß≥</div>Deposit</div>
  <div class="item"><div>‚áÑ</div>Withdraw</div>
  <div class="item"><div>üí≥</div>Plan</div>
  <div class="item"><div>üë§</div>Profile</div>
  <div class="item"><div>üë•</div>Refer</div>
  <div class="item"><div>‚áÜ</div>Transaction</div>
  <div class="item"><div>‚Ñπ</div>About</div>
</div>

<div class="section">
  <h4>Quick Action</h4>
  <button onclick="deposit()">Deposit +100</button>
  <button onclick="withdraw()">Withdraw -50</button>
</div>

<div class="section">
  <h4>Transaction History</h4>
  <div id="txList"></div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, onSnapshot, updateDoc, 
collection, addDoc, query, orderBy } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBFsTzlRPoWHVXEHbKrPdwxslxZGa7Kqfw",
  authDomain: "biniyog-95d00.firebaseapp.com",
  projectId: "biniyog-95d00",
  storageBucket: "biniyog-95d00.appspot.com",
  messagingSenderId: "523238228802",
  appId: "1:523238228802:web:a65183bdc4c268f94efedb"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let uid = null;
let currentBalance = 0;

onAuthStateChanged(auth, user=>{
  if(!user){
    location.href="index.html";
  }else{
    uid = user.uid;
    listenBalance();
    listenTx();
  }
});

function listenBalance(){
  onSnapshot(doc(db,"users",uid),(docu)=>{
    currentBalance = docu.data().balance;
    document.getElementById("balance").innerText = currentBalance;
  });
}

function listenTx(){
  const q = query(collection(db,"users",uid,"transactions"),orderBy("time","desc"));
  onSnapshot(q,(snap)=>{
    let html="";
    snap.forEach(d=>{
      html+=`<div class="tx">${d.data().type} : ‡ß≥ ${d.data().amount}</div>`;
    });
    document.getElementById("txList").innerHTML = html;
  });
}

window.deposit = async ()=>{
  await updateDoc(doc(db,"users",uid),{
    balance: currentBalance + 100
  });
  await addDoc(collection(db,"users",uid,"transactions"),{
    type:"Deposit",
    amount:100,
    time:Date.now()
  });
}

window.withdraw = async ()=>{
  if(currentBalance < 50){ alert("Insufficient balance"); return; }
  await updateDoc(doc(db,"users",uid),{
    balance: currentBalance - 50
  });
  await addDoc(collection(db,"users",uid,"transactions"),{
    type:"Withdraw",
    amount:50,
    time:Date.now()
  });
}

window.logout = ()=>{
  signOut(auth);
}
</script>

</body>
</html>
