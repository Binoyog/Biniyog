<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Biniyog | Refer & Earn</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;font-family:'Hind Siliguri',sans-serif;}
body{margin:0;min-height:100vh;background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);display:flex;justify-content:center;align-items:center;color:#fff;}
.container{width:100%;max-width:420px;background:rgba(0,0,0,0.35);backdrop-filter:blur(10px);border-radius:18px;padding:22px;box-shadow:0 20px 40px rgba(0,0,0,0.45);text-align:center;}
h2{margin:0 0 12px;color:#2fffdc;}
.sub{font-size:14px;color:#c9fef2;margin-bottom:18px;}
.input-box{margin:10px 0;display:flex;gap:8px;}
.input-box input{flex:1;padding:8px;border-radius:14px;border:none;font-size:14px;}
.input-box button{padding:8px 12px;border:none;border-radius:14px;background:#18f2c2;color:#000;font-weight:600;cursor:pointer;}
.input-box button:hover{background:#12d9ae;}
.msg{margin-top:8px;font-size:13px;color:#20B2AA;}
.back a{color:#20B2AA;text-decoration:none;font-size:14px;}
.back a:hover{text-decoration:underline;}
</style>
</head>
<body>
<div class="container">
  <h2>Refer & Earn</h2>
  <div class="sub">নতুন ইউজারের ফোন নাম্বার সাবমিট করুন</div>

  <!-- নতুন ইউজারের ফোন নাম্বার সাবমিট বক্স -->
  <div class="input-box">
    <input type="tel" id="newUserPhone" placeholder="নতুন ইউজারের ফোন নাম্বার" maxlength="11" pattern="[0-9]{11}" required>
    <button id="submitReferral">Submit</button>
  </div>

  <div class="msg" id="msg"></div>

  <div class="back">
    <a href="dashboard.html">← Back to dashboard</a>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBFsTzlRPoWHVXEHbKrPdwxslxZGa7Kqfw",
  authDomain: "biniyog-95d00.firebaseapp.com",
  projectId: "biniyog-95d00",
  storageBucket: "biniyog-95d00.firebasestorage.app",
  messagingSenderId: "523238228802",
  appId: "1:523238228802:web:a65183bdc4c268f94efedb"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser;

onAuthStateChanged(auth, (user)=>{
  if(!user){ location.href="login.html"; return; }
  currentUser = user;
});

// নতুন ইউজার ফোন সাবমিট
document.getElementById("submitReferral").addEventListener("click", async()=>{
  const phone = document.getElementById("newUserPhone").value.trim();
  if(!/^\d{11}$/.test(phone)){
    alert("সঠিক ১১ সংখ্যার ফোন নম্বর লিখুন");
    return;
  }

  try {
    await addDoc(collection(db,"referrals"),{
      uid: currentUser.uid,           // পুরাতন ইউজারের আইডি
      newUserPhone: phone,            // নতুন ফোন
      timestamp: serverTimestamp()
    });

    const msgEl = document.getElementById("msg");
    msgEl.innerText = "নতুন ইউজার ফোন সাবমিট হয়েছে ✔️";
    document.getElementById("newUserPhone").value = "";
    setTimeout(()=>{ msgEl.innerText = ""; },3000);
  } catch(err){
    console.error(err);
    alert("সাবমিট করতে সমস্যা হয়েছে");
  }
});
</script>
</body>
</html>
