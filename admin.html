<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Biniyog | Admin Panel</title>

<style>
body{
  margin:0;
  font-family:Arial, Helvetica, sans-serif;
  background:linear-gradient(135deg,#020617,#0f172a);
  min-height:100vh;
}

/* ===== HEADER ===== */
.header{
  background:rgba(2,6,23,.85);
  backdrop-filter:blur(10px);
  color:#fff;
  padding:14px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 6px 20px rgba(0,0,0,.4);
}
.logout{
  cursor:pointer;
  color:#f87171;
  font-weight:bold;
}

/* ===== DASHBOARD ===== */
.menu{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:16px;
  padding:18px;
}

.icon{
  background:linear-gradient(145deg,#020617,#0f172a);
  border-radius:20px;
  padding:26px 10px;
  text-align:center;
  cursor:pointer;
  color:#fff;
  box-shadow:0 10px 30px rgba(0,0,0,.45);
  transition:.25s;
}
.icon:hover{
  transform:translateY(-6px) scale(1.02);
  box-shadow:0 16px 40px rgba(0,0,0,.6);
}
.icon b{
  font-size:34px;
}
.icon span{
  display:block;
  margin-top:10px;
  font-size:15px;
  color:#e5e7eb;
  font-weight:bold;
}

/* ===== LIST ===== */
.list{
  padding:18px;
}
.list h3{
  color:#e5e7eb;
}
.card{
  background:rgba(255,255,255,.95);
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
  font-size:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.15);
}

/* ===== BUTTON ===== */
button{
  padding:7px 14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  margin-right:6px;
  font-size:13px;
}
.approve{
  background:#22c55e;
  color:#000;
  font-weight:bold;
}
.reject{
  background:#ef4444;
  color:#fff;
}
</style>
</head>

<body>

<div class="header">
  <b>ğŸ‘‘ Biniyog Admin Panel</b>
  <span class="logout" onclick="logout()">Logout</span>
</div>

<div class="menu">
  <div class="icon" onclick="loadDeposits()">
    <b>ğŸ’°</b><span>Deposit</span>
  </div>
  <div class="icon" onclick="loadWithdraws()">
    <b>ğŸ§</b><span>Withdraw</span>
  </div>
  <div class="icon" onclick="loadRefers()">
    <b>ğŸ‘¥</b><span>Refer</span>
  </div>
  <div class="icon" onclick="loadUsers()">
    <b>ğŸ‘¤</b><span>Users</span>
  </div>
</div>

<div class="list" id="list"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth,onAuthStateChanged,signOut } 
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { 
  getFirestore,
  collection,
  getDocs,
  doc,
  updateDoc,
  getDoc,
  addDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* ===== FIREBASE ===== */
const app = initializeApp({
  apiKey:"AIzaSyBFsTzlRPoWHVXEHbKrPdwxslxZGa7Kqfw",
  projectId:"biniyog-95d00"
});
const auth = getAuth(app);
const db = getFirestore(app);

/* ===== ADMIN EMAIL ===== */
const ADMIN_EMAIL = "admin@biniyog.com";
const list = document.getElementById("list");

/* ===== AUTH CHECK ===== */
onAuthStateChanged(auth,user=>{
  if(!user || user.email!==ADMIN_EMAIL){
    location.href="admin-login.html";
  }
});

/* ===== LOGOUT ===== */
window.logout = ()=>{
  signOut(auth).then(()=>{
    location.href="admin-login.html";
  });
};

/* ===== DEPOSIT ===== */
window.loadDeposits = async ()=>{
  list.innerHTML="<h3>ğŸ’° Pending Deposits</h3>";
  const snap = await getDocs(collection(db,"deposits"));
  snap.forEach(d=>{
    const x=d.data();
    if(x.status!=="pending") return;
    list.innerHTML+=`
    <div class="card">
      ğŸ“± ${x.phone || ""}<br>
      ğŸ’° à§³${x.amount}<br>
      ğŸ’³ ${x.method}<br>
      ğŸ”– ${x.trxId}<br><br>
      <button class="approve"
      onclick="approveDeposit('${d.id}','${x.uid}',${x.amount},'${x.method}')">
      Approve</button>
      <button class="reject"
      onclick="rejectDeposit('${d.id}')">
      Reject</button>
    </div>`;
  });
};

window.approveDeposit = async(id,uid,amount,method)=>{
  const uref=doc(db,"users",uid);
  const u=await getDoc(uref);
  await updateDoc(uref,{balance:(u.data().balance||0)+amount});
  await updateDoc(doc(db,"deposits",id),{status:"approved"});
  await addDoc(collection(db,"transactions"),{
    uid,type:"deposit",amount,method,status:"approved",createdAt:serverTimestamp()
  });
  loadDeposits();
};

window.rejectDeposit = async(id)=>{
  await updateDoc(doc(db,"deposits",id),{status:"rejected"});
  loadDeposits();
};

/* ===== WITHDRAW ===== */
window.loadWithdraws = async ()=>{
  list.innerHTML="<h3>ğŸ§ Pending Withdraws</h3>";
  const snap = await getDocs(collection(db,"withdraws"));
  snap.forEach(d=>{
    const x=d.data();
    if(x.status!=="pending") return;
    list.innerHTML+=`
    <div class="card">
      ğŸ“± ${x.phone}<br>
      ğŸ’° à§³${x.amount}<br>
      ğŸ’³ ${x.method}<br><br>
      <button class="approve"
      onclick="approveWithdraw('${d.id}','${x.uid}',${x.amount})">
      Approve</button>
      <button class="reject"
      onclick="rejectWithdraw('${d.id}')">
      Reject</button>
    </div>`;
  });
};

window.approveWithdraw = async(id,uid,amount)=>{
  const uref=doc(db,"users",uid);
  const u=await getDoc(uref);
  await updateDoc(uref,{balance:(u.data().balance||0)-amount});
  await updateDoc(doc(db,"withdraws",id),{status:"approved"});
  await addDoc(collection(db,"transactions"),{
    uid,type:"withdraw",amount,status:"approved",createdAt:serverTimestamp()
  });
  loadWithdraws();
};

window.rejectWithdraw = async(id)=>{
  await updateDoc(doc(db,"withdraws",id),{status:"rejected"});
  loadWithdraws();
};

/* ===== REFER ===== */
window.loadRefers = async ()=>{
  list.innerHTML="<h3>ğŸ‘¥ Pending Referral</h3>";
  const snap = await getDocs(collection(db,"referrals"));
  snap.forEach(d=>{
    const x=d.data();
    if(x.status!=="pending") return;
    list.innerHTML+=`
    <div class="card">
      ğŸ‘¤ UID: ${x.referrerUid}<br>
      ğŸ’° à§³${x.amount}<br><br>
      <button class="approve"
      onclick="approveRefer('${d.id}','${x.referrerUid}',${x.amount})">
      Approve</button>
    </div>`;
  });
};

window.approveRefer = async(id,uid,amount)=>{
  const uref=doc(db,"users",uid);
  const u=await getDoc(uref);
  await updateDoc(uref,{balance:(u.data().balance||0)+amount});
  await updateDoc(doc(db,"referrals",id),{status:"approved"});
  await addDoc(collection(db,"transactions"),{
    uid,type:"refer",amount,status:"approved",createdAt:serverTimestamp()
  });
  loadRefers();
};

/* ===== USERS ===== */
window.loadUsers = async ()=>{
  list.innerHTML="<h3>ğŸ‘¤ Users</h3>";
  const snap = await getDocs(collection(db,"users"));
  snap.forEach(d=>{
    const x=d.data();
    list.innerHTML+=`
    <div class="card">
      ğŸ“± ${x.phone || ""}<br>
      ğŸ’° Balance: à§³${x.balance||0}
    </div>`;
  });
};
</script>

</body>
</html>
