<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Deposit | Biniyog</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h2>ডিপোজিট রিকোয়েস্ট</h2>

<input type="number" id="amount" placeholder="Amount (৳)"><br><br>

<select id="method">
  <option value="">Payment Method</option>
  <option>Bkash</option>
  <option>Nagad</option>
  <option>Rocket</option>
</select><br><br>

<input type="text" id="trx" placeholder="Transaction ID"><br><br>

<button onclick="deposit()">Submit</button>

<p id="msg"></p>

<script type="module">
  import { onAuthStateChanged } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { addDoc, collection } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const auth = window.firebaseAuth;
  const db = window.firebaseDB;
  let user;

  onAuthStateChanged(auth, u => {
    if (!u) location.href = "login.html";
    user = u;
  });

  window.deposit = async function () {
    const amount = Number(amountInput.value);
    const method = methodSelect.value;
    const trxId = trx.value;

    if (amount < 500) {
      msg.innerText = "Minimum deposit 500৳";
      return;
    }
    if (!method || !trxId) {
      msg.innerText = "সব তথ্য দিন";
      return;
    }

    await addDoc(collection(db, "deposit_requests"), {
      uid: user.uid,
      amount,
      method,
      trxId,
      status: "pending",
      time: Date.now()
    });

    alert("ডিপোজিট পেন্ডিং হয়েছে ⏳");
    location.href = "dashboard.html";
  }

  const amountInput = document.getElementById("amount");
  const methodSelect = document.getElementById("method");
  const trx = document.getElementById("trx");
  const msg = document.getElementById("msg");
</script>

</body>
</html>
