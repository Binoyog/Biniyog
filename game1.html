<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coin Flip | Lucky Bet</title>
<style>
body{
    font-family: Arial, sans-serif;
    background:#121212;
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
}
.header{
    font-size:24px;
    font-weight:bold;
    margin-bottom:20px;
}
.balance{
    font-size:20px;
    margin-bottom:20px;
}
.amount-container{
    display:flex;
    align-items:center;
    margin-bottom:20px;
    gap:10px;
}
.amount-container input{
    width:80px;
    padding:6px;
    font-size:16px;
    border-radius:6px;
    border:none;
    text-align:center;
}
.coin{
    width:150px;
    height:150px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:24px;
    margin-bottom:20px;
    perspective: 1000px;
}
.coin-inner{
    width:100%;
    height:100%;
    background:#fff;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#000;
    backface-visibility: hidden;
    transition: transform 1s ease;
    font-weight:bold;
}
button{
    padding:10px 20px;
    font-size:16px;
    margin:0 10px;
    cursor:pointer;
    border:none;
    border-radius:8px;
    background:#d81b60;
    color:#fff;
    transition:0.2s;
}
button:hover{
    background:#e04081;
}
.result{
    font-size:18px;
    margin-top:20px;
    min-height:24px;
}
</style>
</head>
<body>

<div class="header">ðŸª™ Coin Flip</div>
<div class="balance" id="balanceBtn">Balance: à§³0</div>

<div class="amount-container">
    <label>Amount: à§³</label>
    <input type="number" id="betAmount" value="50" min="10">
</div>

<div class="coin" id="coin">
    <div class="coin-inner" id="coinInner">?</div>
</div>

<div>
    <button onclick="flipCoin('Heads')">Heads</button>
    <button onclick="flipCoin('Tails')">Tails</button>
</div>

<div class="result" id="result"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, doc, onSnapshot, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyBFsTzlRPoWHVXEHbKrPdwxslxZGa7Kqfw",
  authDomain: "biniyog-95d00.firebaseapp.com",
  projectId: "biniyog-95d00"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let liveBalance = 0;
let userRef;

const balanceBtn = document.getElementById('balanceBtn');
const coinInner = document.getElementById('coinInner');
const resultDiv = document.getElementById('result');
const betInput = document.getElementById('betAmount');

/* AUTH + BALANCE INIT */
onAuthStateChanged(auth, async user=>{
    if(!user){
        location.href="index.html";
        return;
    }

    userRef = doc(db,"users",user.uid);

    /* Realtime balance listener */
    onSnapshot(userRef, docSnap=>{
        if(docSnap.exists()){
            liveBalance = docSnap.data().balance || 0;
            balanceBtn.innerText = "Balance: à§³"+liveBalance;
        }
    });
});

/* Coin Flip Logic */
async function flipCoin(userChoice){
    const bet = parseInt(betInput.value);
    if(bet <= 0 || bet > liveBalance){
        alert("Invalid bet amount!");
        return;
    }

    // Animate coin flip
    coinInner.style.transform = 'rotateY(720deg)';
    coinInner.innerText = '?';
    resultDiv.innerText = '';

    setTimeout(async ()=>{
        const outcome = Math.random() < 0.5 ? 'Heads' : 'Tails';
        coinInner.innerText = outcome;

        let resultText="";
        let newBalance = liveBalance;

        if(userChoice === outcome){
            newBalance += bet; // win
            resultText = `ðŸŽ‰ You Won! +à§³${bet}`;
        } else {
            newBalance -= bet; // lose
            resultText = `ðŸ˜ž You Lost! -à§³${bet}`;
        }
        resultDiv.innerText = resultText;

        // Update balance in Firestore
        await updateDoc(userRef,{
            balance: newBalance,
            lastFlip: serverTimestamp()
        });
    }, 1000); // 1 sec animation
}
</script>

</body>
</html>
